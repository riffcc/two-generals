<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two Generals Protocol - Interactive Visualizer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Two Generals Protocol</h1>
            <p class="subtitle">A Deterministically Failsafe Solution to the Coordinated Attack Problem</p>
            <div class="hero-stats">
                <div class="hero-stat">
                    <span class="hero-number">10<sup>-1565</sup></span>
                    <span class="hero-label">Failure Probability</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-number">0</span>
                    <span class="hero-label">Asymmetric Outcomes</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-number">33</span>
                    <span class="hero-label">Lean 4 Theorems</span>
                </div>
                <div class="hero-stat">
                    <span class="hero-number">0</span>
                    <span class="hero-label">Sorry Statements</span>
                </div>
            </div>
            <p class="hero-quote">"You would need to run this protocol once per picosecond, on every atom in a trillion universes, from the Big Bang until the heat death of the cosmos, and you still would not expect to see a single failure."</p>
        </header>

        <main>
            <section class="controls">
                <div class="control-group">
                    <label for="loss-rate">Packet Loss Rate: <span id="loss-value">50%</span></label>
                    <input type="range" id="loss-rate" min="0" max="100" value="50">
                    <div class="loss-presets">
                        <button class="loss-preset" data-loss="50">50%</button>
                        <button class="loss-preset" data-loss="90">90%</button>
                        <button class="loss-preset" data-loss="99">99%</button>
                        <button class="loss-preset" data-loss="99.9">99.9%</button>
                        <button class="loss-preset" data-loss="99.99">99.99%</button>
                        <button class="loss-preset" data-loss="99.9999">99.9999%</button>
                    </div>
                </div>
                <div class="control-group">
                    <label for="speed">Simulation Speed: <span id="speed-value">1x</span></label>
                    <input type="range" id="speed" min="0" max="4" step="1" value="0">
                    <div class="speed-legend">1x â†’ 5x â†’ 50x â†’ 500x â†’ 5000x</div>
                </div>
                <div class="button-group">
                    <button id="start-btn" class="primary">Start Protocol</button>
                    <button id="reset-btn">Reset</button>
                </div>
            </section>

            <section class="visualization">
                <div class="party-container">
                    <div class="party" id="alice">
                        <h3>Alice (General A)</h3>
                        <div class="state-indicator">
                            <span class="phase">Phase: <strong id="alice-phase">INIT</strong></span>
                            <span class="status" id="alice-status">Waiting</span>
                        </div>
                        <div class="proof-stack" id="alice-proofs">
                            <!-- Proof artifacts will be rendered here -->
                        </div>
                    </div>

                    <div class="channel" id="network">
                        <svg id="packet-svg" viewBox="0 0 400 200"></svg>
                        <div class="channel-stats">
                            <span>Sent: <strong id="packets-sent">0</strong></span>
                            <span>Lost: <strong id="packets-lost">0</strong></span>
                            <span>Delivered: <strong id="packets-delivered">0</strong></span>
                        </div>
                    </div>

                    <div class="party" id="bob">
                        <h3>Bob (General B)</h3>
                        <div class="state-indicator">
                            <span class="phase">Phase: <strong id="bob-phase">INIT</strong></span>
                            <span class="status" id="bob-status">Waiting</span>
                        </div>
                        <div class="proof-stack" id="bob-proofs">
                            <!-- Proof artifacts will be rendered here -->
                        </div>
                    </div>
                </div>
            </section>

            <section class="proof-escalation">
                <h2>Proof Escalation Progress</h2>
                <div class="escalation-diagram">
                    <div class="level" id="level-c">
                        <span class="level-name">Commitment (C)</span>
                        <div class="level-bars">
                            <div class="bar alice-bar" id="alice-c"></div>
                            <div class="bar bob-bar" id="bob-c"></div>
                        </div>
                    </div>
                    <div class="level" id="level-d">
                        <span class="level-name">Double Proof (D)</span>
                        <div class="level-bars">
                            <div class="bar alice-bar" id="alice-d"></div>
                            <div class="bar bob-bar" id="bob-d"></div>
                        </div>
                    </div>
                    <div class="level" id="level-t">
                        <span class="level-name">Triple Proof (T)</span>
                        <div class="level-bars">
                            <div class="bar alice-bar" id="alice-t"></div>
                            <div class="bar bob-bar" id="bob-t"></div>
                        </div>
                    </div>
                    <div class="level" id="level-q">
                        <span class="level-name">Quad Proof (Q)</span>
                        <div class="level-bars">
                            <div class="bar alice-bar" id="alice-q"></div>
                            <div class="bar bob-bar" id="bob-q"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="outcome">
                <h2>Protocol Outcome</h2>
                <div class="outcome-display" id="outcome">
                    <span class="pending">Awaiting protocol completion...</span>
                </div>
                <div class="stats">
                    <div class="stat">
                        <span class="stat-label">Time Elapsed</span>
                        <span class="stat-value" id="elapsed-time">0.00s</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Total Packets</span>
                        <span class="stat-value" id="total-packets">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Actual Loss Rate</span>
                        <span class="stat-value" id="actual-loss">0%</span>
                    </div>
                </div>
            </section>

            <section class="theseus-test">
                <h2>Protocol of Theseus Test</h2>
                <p>Run multiple simulations to verify symmetric outcomes across all loss rates.</p>
                <div class="theseus-controls">
                    <button id="run-theseus" class="primary">Run 100 Simulations</button>
                    <span id="theseus-progress"></span>
                </div>
                <div class="theseus-results" id="theseus-results">
                    <!-- Results will be rendered here -->
                </div>
            </section>

            <section class="proof-nesting">
                <h2>Proof Nesting Visualization</h2>
                <p class="section-description">Each proof level embeds the previous, creating self-certifying artifacts</p>
                <div class="nesting-diagram" id="nesting-diagram">
                    <svg id="nesting-svg" viewBox="0 0 800 400"></svg>
                </div>
            </section>

            <section class="probability-scale">
                <h2>Probability Scale Comparison</h2>
                <p class="section-description">Understanding 10<sup>-1565</sup> in perspective</p>
                <div class="scale-chart">
                    <div class="scale-item">
                        <div class="scale-bar" style="width: 0.00001%"></div>
                        <span class="scale-value">10<sup>-1565</sup></span>
                        <span class="scale-label">TGP Protocol Failure</span>
                    </div>
                    <div class="scale-item">
                        <div class="scale-bar" style="width: 0.001%"></div>
                        <span class="scale-value">10<sup>-77</sup></span>
                        <span class="scale-label">Guessing 256-bit key first try</span>
                    </div>
                    <div class="scale-item">
                        <div class="scale-bar" style="width: 0.1%"></div>
                        <span class="scale-value">10<sup>-43</sup></span>
                        <span class="scale-label">Spontaneous quantum tunneling of DNA</span>
                    </div>
                    <div class="scale-item">
                        <div class="scale-bar" style="width: 1%"></div>
                        <span class="scale-value">10<sup>-9</sup></span>
                        <span class="scale-label">Cosmic ray bit flip (per hour)</span>
                    </div>
                    <div class="scale-item">
                        <div class="scale-bar" style="width: 10%"></div>
                        <span class="scale-value">10<sup>-6</sup></span>
                        <span class="scale-label">Airplane fatality per flight</span>
                    </div>
                </div>
                <p class="scale-insight">The protocol's failure probability is <strong>1,488 orders of magnitude</strong> smaller than guessing a 256-bit key on the first try.</p>
            </section>

            <section class="risk-decomposition">
                <h2>Risk Decomposition</h2>
                <p class="section-description">Where does residual risk actually come from?</p>
                <div class="risk-breakdown">
                    <div class="risk-item zero">
                        <span class="risk-label">Protocol Logic</span>
                        <span class="risk-value">0</span>
                        <span class="risk-note">Lean-proven safe</span>
                    </div>
                    <div class="risk-item negligible">
                        <span class="risk-label">Liveness Tail</span>
                        <span class="risk-value">&lt;10<sup>-1565</sup></span>
                        <span class="risk-note">Adjustable via flooding</span>
                    </div>
                    <div class="risk-item negligible">
                        <span class="risk-label">Cryptographic</span>
                        <span class="risk-value">â‰ˆ2<sup>-128</sup></span>
                        <span class="risk-note">Ed25519 signature</span>
                    </div>
                    <div class="risk-item material">
                        <span class="risk-label">Implementation</span>
                        <span class="risk-value">~0.04%</span>
                        <span class="risk-note">Only material contributor</span>
                    </div>
                </div>
                <p class="risk-insight">The dominant source of risk is no longer the protocol logic or channel unreliability. It's implementation fidelityâ€”the hallmark of a <strong>solved problem in engineering</strong>.</p>
            </section>

            <section class="lean-verification">
                <h2>Lean 4 Formal Verification</h2>
                <p class="section-description">Machine-verified correctness, not just testing</p>
                <div class="lean-stats">
                    <div class="lean-stat">
                        <span class="lean-number">33+</span>
                        <span class="lean-label">Theorems</span>
                    </div>
                    <div class="lean-stat">
                        <span class="lean-number">0</span>
                        <span class="lean-label">Sorry Statements</span>
                    </div>
                    <div class="lean-stat">
                        <span class="lean-number">4</span>
                        <span class="lean-label">Proof Layers</span>
                    </div>
                    <div class="lean-stat">
                        <span class="lean-number">5.5s</span>
                        <span class="lean-label">Build Time</span>
                    </div>
                </div>
                <div class="lean-theorems">
                    <div class="theorem">
                        <code>theorem safety</code>
                        <span>Impossible for one party to ATTACK while other REJECTs</span>
                    </div>
                    <div class="theorem">
                        <code>theorem attack_needs_both</code>
                        <span>ATTACK requires both parties reaching commitment</span>
                    </div>
                    <div class="theorem">
                        <code>theorem bilateral_receipt_implies_common_knowledge</code>
                        <span>Bilateral receipt pair establishes full common knowledge</span>
                    </div>
                    <div class="theorem">
                        <code>theorem common_knowledge_implies_coordination</code>
                        <span>Common knowledge guarantees symmetric action</span>
                    </div>
                </div>
            </section>

            <section class="explanation">
                <h2>How It Works</h2>
                <div class="explainer">
                    <div class="step">
                        <h4>Phase 1: Commitment (C)</h4>
                        <p>Each party generates and floods a signed commitment: "I will attack if you agree"</p>
                        <code class="proof-formula">C_X = Sign_X("I will attack at dawn if you agree")</code>
                    </div>
                    <div class="step">
                        <h4>Phase 2: Double Proof (D)</h4>
                        <p>Upon receiving counterparty's C, construct D embedding both commitments</p>
                        <code class="proof-formula">D_X = Sign_X(C_X âˆ¥ C_Y âˆ¥ "Both committed")</code>
                    </div>
                    <div class="step">
                        <h4>Phase 3: Triple Proof (T)</h4>
                        <p>Upon receiving D, construct T containing all prior proofs</p>
                        <code class="proof-formula">T_X = Sign_X(D_X âˆ¥ D_Y âˆ¥ "Both have doubles")</code>
                    </div>
                    <div class="step">
                        <h4>Phase 4: Quaternary Fixpoint (Q)</h4>
                        <p>The bilateral receipt pair that proves mutual constructibility</p>
                        <code class="proof-formula">Q_X = Sign_X(T_X âˆ¥ T_Y âˆ¥ "Fixpoint achieved")</code>
                    </div>
                </div>
                <div class="key-insight">
                    <strong>ðŸ”— The Bilateral Construction Property:</strong><br>
                    Q_A exists â†’ contains T_B â†’ Bob had D_A â†’ Bob can construct T_B â†’ Bob can construct Q_B<br>
                    <em>Each half cryptographically proves the other half is constructible.</em>
                </div>
            </section>
        </main>

        <footer>
            <div class="dedication">
                <p class="dedication-text">In memory of Aaron Swartz (1986â€“2013)</p>
                <p class="dedication-quote">"Information is power. But like all power, there are those who want to keep it for themselves."</p>
                <p class="dedication-note">This work is released freely because open protocols are infrastructure, not property.</p>
            </div>
            <div class="footer-links">
                <a href="../paper/main.pdf" class="paper-link">ðŸ“„ Read the Paper (PDF)</a>
                <a href="https://github.com/riffcc/two-generals" class="github-link">ðŸ”— View Source</a>
            </div>
            <p class="footer-meta">&copy; 2025 Riff Labs | AGPLv3 | <em>e cinere surgemus</em></p>
        </footer>
    </div>

    <script type="module" src="visualizer.js"></script>
</body>
</html>
